generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
}

model admin_activity {
  activity_id        Int       @id @default(autoincrement())
  admin_id           Int?
  action_type        String    @db.VarChar(100)
  action_description String
  created_at         DateTime? @default(now()) @db.Timestamp(6)
  admins             admins?   @relation(fields: [admin_id], references: [admin_id], onDelete: Cascade, onUpdate: NoAction)
}

model admins {
  admin_id       Int              @id
  admin_activity admin_activity[]
  users          users            @relation(fields: [admin_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([admin_id], map: "idx_admins_admin_id")
}

model badges {
  badge_id    Int           @id @default(autoincrement())
  badge_type  String        @db.VarChar(50)
  name        String        @db.VarChar(100)
  description String
  image_path  String        @db.VarChar(255)
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  user_badges user_badges[]
}

model comments {
  comment_id   Int       @id @default(autoincrement())
  user_id      Int?
  content_type String    @db.VarChar(50)
  content_id   Int
  comment_text String
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)
  users        users?    @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)
}

model course {
  course_id       Int               @id @default(autoincrement())
  name            String            @db.VarChar(255)
  description     String?
  status          String?           @default("Draft") @db.VarChar(50)
  difficulty      String?           @db.VarChar(50)
  language_id     Int?
  image           String?
  is_active       Boolean?          @default(true)
  rating          Decimal?          @default(0) @db.Decimal(3, 2)
  created_at      DateTime          @default(now()) @db.Timestamptz(6)
  enrollment      enrollment[]
  feedback        feedback[]
  lesson_progress lesson_progress[]
  section         section[]

  @@index([status], map: "idx_course_status")
}

model enrollment {
  enrollment_id   Int       @id @default(autoincrement())
  user_id         Int?
  course_id       Int?
  enrollment_date DateTime? @default(now()) @db.Timestamp(6)
  progress        Decimal?  @default(0) @db.Decimal(5, 2)
  course          course?   @relation(fields: [course_id], references: [course_id], onDelete: Cascade, onUpdate: NoAction)
  users           users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, course_id])
  @@index([course_id], map: "idx_enrollment_course_id")
  @@index([course_id, user_id], map: "idx_enrollment_course_user")
  @@index([user_id, course_id], map: "idx_enrollment_user_course")
  @@index([user_id], map: "idx_enrollment_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model feedback {
  feedback_id Int       @id @default(autoincrement())
  user_id     Int?
  course_id   Int?
  rating      Int
  comment     String?
  status      String?   @default("pending") @db.VarChar(50)
  reply       String?
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  course      course?   @relation(fields: [course_id], references: [course_id], onDelete: Cascade, onUpdate: NoAction)
  users       users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([course_id], map: "idx_feedback_course_id")
  @@index([course_id, rating], map: "idx_feedback_course_rating")
  @@index([created_at(sort: Desc)], map: "idx_feedback_created_at")
  @@index([user_id], map: "idx_feedback_user_id")
}

model lesson {
  lesson_id       Int               @id @default(autoincrement())
  section_id      Int?
  name            String            @db.VarChar(255)
  content         String
  xp              Int?              @default(0)
  test_cases      Json?             @default("[]")
  lesson_order    Int
  template_code   String?           @default("")
  hint            String?
  solution        String?
  auto_detect     Boolean?          @default(false)
  section         section?          @relation(fields: [section_id], references: [section_id], onDelete: Cascade, onUpdate: NoAction)
  lesson_progress lesson_progress[]

  @@index([section_id], map: "idx_lesson_section_id")
  @@index([section_id, lesson_order], map: "idx_lesson_section_order")
}

model lesson_progress {
  progress_id       Int       @id @default(autoincrement())
  user_id           Int?
  lesson_id         Int?
  completed         Boolean?  @default(false)
  completed_at      DateTime? @db.Timestamp(6)
  course_id         Int?
  submitted_code    String?
  hint_unlocked     Boolean?  @default(false)
  solution_unlocked Boolean?  @default(false)
  course            course?   @relation(fields: [course_id], references: [course_id], onDelete: Cascade, onUpdate: NoAction)
  lesson            lesson?   @relation(fields: [lesson_id], references: [lesson_id], onDelete: Cascade, onUpdate: NoAction)
  users             users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, lesson_id])
  @@index([lesson_id], map: "idx_lesson_progress_lesson_id")
  @@index([user_id, course_id], map: "idx_lesson_progress_user_course")
  @@index([user_id, course_id, completed], map: "idx_lesson_progress_user_course_completed")
  @@index([user_id], map: "idx_lesson_progress_user_id")
  @@index([user_id, lesson_id], map: "idx_lesson_progress_user_lesson")
}

model payment {
  payment_id     Int       @id @default(autoincrement())
  user_id        Int?
  amount         Decimal   @db.Decimal(10, 2)
  payment_date   DateTime? @default(now()) @db.Timestamp(6)
  status         String    @db.VarChar(50)
  payment_method String?   @db.VarChar(50)
  transaction_id String?   @db.VarChar(255)
  users          users?    @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)
}

model recent_activity {
  activity_id        Int       @id @default(autoincrement())
  action_type        String    @db.VarChar(100)
  action_description String
  user_id            Int?
  created_at         DateTime? @default(now()) @db.Timestamp(6)
  users              users?    @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_recent_activity_timestamp")
  @@index([user_id], map: "idx_recent_activity_user_id")
}

model refresh_tokens {
  id         Int       @id @default(autoincrement())
  user_id    Int       @unique
  token      String    @unique @db.VarChar(255)
  expires_at DateTime  @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  users      users     @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([token], map: "idx_refresh_tokens_token")
  @@index([user_id], map: "idx_refresh_tokens_user_id")
}

model section {
  section_id    Int      @id @default(autoincrement())
  course_id     Int?
  name          String   @db.VarChar(255)
  description   String?
  section_order Int
  lesson        lesson[]
  course        course?  @relation(fields: [course_id], references: [course_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([course_id], map: "idx_section_course_id")
  @@index([course_id, section_order], map: "idx_section_course_order")
}

model site_visits {
  visit_id     Int       @id @default(autoincrement())
  user_id      Int?
  ip_address   String?   @db.VarChar(45)
  visit_date   DateTime? @default(now()) @db.Timestamp(6)
  page_visited String    @db.VarChar(255)
  referrer     String?   @db.VarChar(255)
  device_type  String?   @db.VarChar(50)
  browser      String?   @db.VarChar(100)
  os           String?   @db.VarChar(100)
  country      String?   @db.VarChar(100)
  city         String?   @db.VarChar(100)
  users        users?    @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)

  @@index([browser], map: "idx_site_visits_browser")
  @@index([country], map: "idx_site_visits_country")
  @@index([device_type], map: "idx_site_visits_device_type")
  @@index([page_visited], map: "idx_site_visits_page_visited")
  @@index([visit_date(sort: Desc)], map: "idx_site_visits_visit_date")
}

model subscription {
  subscription_id         Int                 @id @default(autoincrement())
  subscription_start_date DateTime            @db.Timestamp(6)
  subscription_end_date   DateTime            @db.Timestamp(6)
  subscription_type       String              @db.VarChar(50)
  amount_paid             Decimal             @db.Decimal(10, 2)
  status                  Boolean
  user_email              String?             @db.VarChar(255)
  user_id                 Int?
  stripe_subscription_id  String?             @db.VarChar(255)
  stripe_payment_id       String?             @db.VarChar(255)
  stripe_customer_id      String?             @db.VarChar(255)
  users                   users?              @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)
  user_subscription       user_subscription[]

  @@index([status], map: "idx_subscription_status")
  @@index([status, subscription_end_date], map: "idx_subscription_status_enddate")
  @@index([user_id], map: "idx_subscription_user_id")
  @@index([user_id, subscription_type], map: "idx_subscription_user_type")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model support {
  ticket_id           Int                      @id @default(autoincrement())
  user_email          String                   @db.VarChar(255)
  time_opened         DateTime?                @default(now()) @db.Timestamp(6)
  expiration_time     DateTime?                @db.Timestamp(6)
  status              String?                  @default("open") @db.VarChar(50)
  closed_by           String?                  @db.VarChar(50)
  closed_at           DateTime?                @db.Timestamp(6)
  category            String?                  @default("general") @db.VarChar(50)
  priority            String?                  @default("medium") @db.VarChar(20)
  assigned_to         String?                  @db.VarChar(255)
  sla_target          DateTime?                @db.Timestamptz(6)
  resolution_time     Unsupported("interval")?
  satisfaction_rating Int?
  ticket_messages     ticket_messages[]

  @@index([assigned_to], map: "idx_support_assigned_to")
  @@index([category], map: "idx_support_category")
  @@index([time_opened(sort: Desc)], map: "idx_support_created_at")
  @@index([priority], map: "idx_support_priority")
  @@index([sla_target], map: "idx_support_sla_target")
  @@index([status], map: "idx_support_status")
  @@index([status, time_opened], map: "idx_support_status_time")
  @@index([user_email], map: "idx_support_user_email")
}

model system_settings {
  setting_id       Int       @id
  maintenance_mode Boolean   @default(false)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_by       Int?
  users            users?    @relation(fields: [updated_by], references: [user_id], onUpdate: NoAction)
}

model ticket_messages {
  message_id       Int       @id @default(autoincrement())
  ticket_id        Int?
  message_content  String
  sender_type      String    @db.VarChar(50)
  sent_at          DateTime? @default(now()) @db.Timestamp(6)
  is_auto_response Boolean?  @default(false)
  support          support?  @relation(fields: [ticket_id], references: [ticket_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sent_at], map: "idx_ticket_messages_sent_at")
  @@index([ticket_id], map: "idx_ticket_messages_ticket_id")
}

model user_activity {
  activity_id Int       @id @default(autoincrement())
  user_id     Int?
  action_type String    @db.VarChar(50)
  resource_id Int?
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  users       users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_user_activity_created_at")
}

model user_badges {
  user_badge_id Int       @id @default(autoincrement())
  user_id       Int
  badge_id      Int
  awarded_at    DateTime? @default(now()) @db.Timestamp(6)
  badges        badges    @relation(fields: [badge_id], references: [badge_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, badge_id])
}

model user_sessions {
  session_id       Int       @id @default(autoincrement())
  user_id          Int?
  session_start    DateTime? @default(now()) @db.Timestamp(6)
  session_end      DateTime? @db.Timestamp(6)
  session_duration Int?
  page_views       Int?      @default(0)
  bounce           Boolean?  @default(false)
  ip_address       String?   @db.VarChar(45)
  device_type      String?   @db.VarChar(50)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  users            users?    @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_user_sessions_created_at")
  @@index([user_id, session_start(sort: Desc), session_end], map: "idx_user_sessions_emergency")
  @@index([session_start(sort: Desc)], map: "idx_user_sessions_session_start")
  @@index([user_id], map: "idx_user_sessions_user_id")
  @@index([user_id, session_end, session_start(sort: Desc)], map: "idx_user_sessions_user_id_session_end_start")
}

model user_subscription {
  user_id         Int
  subscription_id Int
  subscription    subscription @relation(fields: [subscription_id], references: [subscription_id], onDelete: NoAction, onUpdate: NoAction)
  users           users        @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, subscription_id])
  @@index([subscription_id], map: "idx_user_subscription_subscription_id")
  @@index([user_id], map: "idx_user_subscription_user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model users {
  user_id            Int                 @id @default(autoincrement())
  name               String              @db.VarChar(255)
  email              String              @unique @db.VarChar(255)
  password           String              @db.VarChar(255)
  country            String?             @db.VarChar(100)
  bio                String?
  profileimage       String?
  created_at         DateTime?           @default(now()) @db.Timestamp(6)
  is_verified        Boolean?            @default(false)
  streak             Int?                @default(0)
  skills             Json?               @default("[]")
  last_streak_update DateTime?           @default(now()) @db.Timestamptz(6)
  streak_count       Int?                @default(0)
  current_streak     Int?                @default(0)
  max_streak         Int?                @default(0)
  last_visit         DateTime?           @default(now()) @db.Timestamptz(6)
  last_login         DateTime?           @db.Timestamp(6)
  stripe_customer_id String?             @db.VarChar(255)
  admins             admins?
  comments           comments[]
  enrollment         enrollment[]
  feedback           feedback[]
  lesson_progress    lesson_progress[]
  payment            payment[]
  recent_activity    recent_activity[]
  refresh_tokens     refresh_tokens?
  site_visits        site_visits[]
  subscription       subscription[]
  system_settings    system_settings[]
  user_activity      user_activity[]
  user_sessions      user_sessions[]
  user_subscription  user_subscription[]

  @@index([created_at], map: "idx_users_created_at")
  @@index([email], map: "idx_users_email")
  @@index([last_login(sort: Desc)], map: "idx_users_last_login")
  @@index([user_id, last_streak_update, last_visit], map: "idx_users_streak_update")
  @@index([stripe_customer_id], map: "idx_users_stripe_customer_id")
}
